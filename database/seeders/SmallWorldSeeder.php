<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Carbon;

class SmallWorldSeeder extends Seeder
{
    public function run(): void
    {
        DB::transaction(function () {
            $now = Carbon::now();

            $editions = [
                'Small World (base)',
                'Small World: Cursed!',
                'Small World: Grand Dames',
                'Small World: Royal Bonus',
                'Small World: Be Not Afraid!',
                'Small World: A Spider\'s Web',
                'Small World: Sky Islands',
                'Small World: Underground',
            ];

            foreach ($editions as $name) {
                DB::table('smallworld.editions')->updateOrInsert(
                    ['name' => $name],
                    ['updated_at' => $now, 'created_at' => $now]
                );
            }

            $editionIds = DB::table('smallworld.editions')->pluck('id', 'name');

            DB::statement('DELETE FROM smallworld.races');
            DB::statement('DELETE FROM smallworld.abilities');

            $races = [
                // Base
                ['Амазонки', 6, 'Во время завоеваний получают 4 временных жетона.', 'Small World (base)'],
                ['Гномы', 3, 'Монеты за шахты.', 'Small World (base)'],
                ['Эльфы', 6, 'Потери возвращаются в руку.', 'Small World (base)'],
                ['Упыри', 5, 'В упадке продолжают захватывать.', 'Small World (base)'],
                ['Великаны', 6, 'Со скал атакуют на 1 дешевле.', 'Small World (base)'],
                ['Полурослики', 6, 'Два логова, неуязвимые регионы.', 'Small World (base)'],
                ['Люди', 5, 'Монеты за поля.', 'Small World (base)'],
                ['Орки', 5, 'Монеты за захват занятых регионов.', 'Small World (base)'],
                ['Крысолюды', 8, 'Много жетонов, без бонусов.', 'Small World (base)'],
                ['Скелеты', 6, 'Получают жетоны за захваты.', 'Small World (base)'],
                ['Колдуны', 5, 'Превращают одиночные жетоны.', 'Small World (base)'],
                ['Тритоны', 6, 'У воды атакуют на 1 дешевле.', 'Small World (base)'],
                ['Тролли', 5, 'Логова +1 к защите.', 'Small World (base)'],
                ['Волшебники', 5, 'Монеты за магические символы.', 'Small World (base)'],

                // Cursed!
                ['Гоблины', 6, 'Дешевле берут регионы с упадшими.', 'Small World: Cursed!'],
                ['Кобольды', 11, 'Нельзя оставлять одиночные жетоны.', 'Small World: Cursed!'],

                // Grand Dames
                ['Цыгане', 6, 'Переезд даёт монеты.', 'Small World: Grand Dames'],
                ['Жрицы', 4, 'Храм прячет жетоны при упадке.', 'Small World: Grand Dames'],
                ['Белые Дамы', 2, 'Неуязвимы, но мало жетонов.', 'Small World: Grand Dames'],

                // Royal Bonus
                ['Фавны', 5, 'Бонус за сопредельные захваты.', 'Small World: Royal Bonus'],
                ['Игорьцы', 4, 'Забирают жетоны побеждённых.', 'Small World: Royal Bonus'],
                ['Кустолюды', 6, 'Бонус за леса при упадке.', 'Small World: Royal Bonus'],

                // Be Not Afraid!
                ['Варвары', 9, 'Не перегруппировываются.', 'Small World: Be Not Afraid!'],
                ['Гомункулы', 5, 'Чем дольше не берут — тем больше.', 'Small World: Be Not Afraid!'],
                ['Лепреконы', 6, 'Кладут горшочки с золотом.', 'Small World: Be Not Afraid!'],
                ['Пикси', 11, 'В регионах остаётся по одному.', 'Small World: Be Not Afraid!'],
                ['Пигмеи', 6, 'Возвращаются из запаса при потере.', 'Small World: Be Not Afraid!'],

                // A Spider's Web
                ['Ледяные Ведьмы', 5, 'Замораживают соседей.', 'Small World: A Spider\'s Web'],
                ['Скагги', 6, 'Бонус за рассредоточение.', 'Small World: A Spider\'s Web'],
                ['Пращники', 5, 'Дальние захваты.', 'Small World: A Spider\'s Web'],

                // Sky Islands
                ['Драконы', 6, 'Временно превращают жетоны в драконов.', 'Small World: Sky Islands'],
                ['Эскарго', 12, 'Медленные, но многочисленные.', 'Small World: Sky Islands'],
                ['Ханы', 5, 'Набеги по степям.', 'Small World: Sky Islands'],
                ['Пугала', 12, 'Иммунные пустышки-охранники.', 'Small World: Sky Islands'],
                ['Падальщики', 6, 'Монеты за опустошённые регионы.', 'Small World: Sky Islands'],
                ['Грозовые Великаны', 6, 'Молнии для штурма.', 'Small World: Sky Islands'],
                ['Вендиго', 6, 'Замораживают регионы.', 'Small World: Sky Islands'],

                // Underground (все с числами с баннеров)
                ['Культисты', 5, 'Древний делает соседние регионы дешевле.', 'Small World: Underground'],
                ['Дроу', 6, 'Монеты за изолированные регионы.', 'Small World: Underground'],
                ['Пламя', 4, 'Вулкан делает соседние регионы пустыми для атаки.', 'Small World: Underground'],
                ['Гномы Подземья', 7, 'Неуязвимы для эффектов соперников на их ход.', 'Small World: Underground'],
                ['Железные Гномы', 7, 'Куют серебряные молоты для атаки.', 'Small World: Underground'],
                ['Грязевики', 7, 'Получают жетоны из грязевых луж.', 'Small World: Underground'],
                ['Мумии', 10, 'Все завоевания дороже на 1.', 'Small World: Underground'],
                ['Огры', 5, 'Захватывают на 1 дешевле.', 'Small World: Underground'],
                ['Тенемимы', 7, 'Меняют спецсилу на любую видимую.', 'Small World: Underground'],
                ['Грибники', 5, 'Бонус за грибной лес.', 'Small World: Underground'],
                ['Паукоиды', 7, 'Считают пропасти смежными.', 'Small World: Underground'],
                ['Блуждающие Огни', 6, 'Кидают подкрепление до атаки кристаллов.', 'Small World: Underground'],
                ['Ящеролюды', 7, 'Проходят по реке без удержания жетонов.', 'Small World: Underground'],
                ['Личи', 5, 'Соперник платит при захвате их упадших регионов.', 'Small World: Underground'],
                ['Кракен', 5, 'Оставляет жетоны на реке и начисляет монеты.', 'Small World: Underground'],
            ];

            $abilities = [
                // Core game
                ['Алхимик', 4, 'Каждый ход +2 монеты.', 'Small World (base)'],
                ['Берсерк', 4, 'Бросок подкрепления перед каждой атакой.', 'Small World (base)'],
                ['Лагеря', 5, '5 укреплений по +1 к защите.', 'Small World (base)'],
                ['Коммандос', 4, 'Все захваты на 1 жетон дешевле.', 'Small World (base)'],
                ['Дипломат', 5, 'Выбираешь соседа, который не сможет атаковать тебя.', 'Small World (base)'],
                ['Повелитель Дракона', 5, 'Раз в ход драконовский захват за 1 жетон, регион становится неуязвим.', 'Small World (base)'],
                ['Летающие', 5, 'Можно захватывать любой регион.', 'Small World (base)'],
                ['Лесные', 4, '+1 монета за леса.', 'Small World (base)'],
                ['Укреплённые', 3, 'Крепость даёт +1 к защите и +1 монету.', 'Small World (base)'],
                ['Героические', 5, 'Два героических региона неуязвимы.', 'Small World (base)'],
                ['Холмистые', 4, '+1 монета за холмы.', 'Small World (base)'],
                ['Торговцы', 2, '+1 монета за каждый регион.', 'Small World (base)'],
                ['Всадники', 5, 'Холмы и поля на 1 дешевле.', 'Small World (base)'],
                ['Грабящие', 5, '+1 монета за каждый захваченный занятый регион.', 'Small World (base)'],
                ['Мореплаватели', 5, 'Захватывать и держать моря/озёра.', 'Small World (base)'],
                ['Духи', 5, 'Упадшая раса духов не занимает слот упадка.', 'Small World (base)'],
                ['Выносливые', 4, 'Можно уйти в упадок после обычного хода.', 'Small World (base)'],
                ['Болотные', 4, '+1 монета за болота.', 'Small World (base)'],
                ['Подземные', 5, 'Пещеры на 1 дешевле и все пещеры смежны.', 'Small World (base)'],
                ['Богатые', 4, 'Разово +7 монет в первый ход.', 'Small World (base)'],

                // A Spider's Web
                ['Подражатели', 3, 'В начале хода копируешь один из 6 видимых пауэров.', 'Small World: A Spider\'s Web'],
                ['Лава', 5, 'После хода кладёшь лаву от гор, блокируя регионы до твоего следующего хода.', 'Small World: A Spider\'s Web'],
                ['Прикосновение Душ', 4, 'Упадок оживляет предыдущую упавшую расу вместо взятия новой.', 'Small World: A Spider\'s Web'],

                // Be Not Afraid!
                ['Баррикады', 4, '+3 монеты, если в конце хода у тебя ≤4 региона.', 'Small World: Be Not Afraid!'],
                ['Катапульта', 4, 'Раз в ход дальний штурм через 1 регион, регион с катапультой неуязвим.', 'Small World: Be Not Afraid!'],
                ['Коррупция', 4, 'Соперники платят монету, когда берут твои активные регионы.', 'Small World: Be Not Afraid!'],
                ['Имперские', 4, '+1 монета за каждый регион сверх трёх.', 'Small World: Be Not Afraid!'],
                ['Наёмники', 4, 'Монетой уменьшаешь стоимость штурма на 2.', 'Small World: Be Not Afraid!'],

                // Grand Dames
                ['Историки', 5, 'Монеты за каждый упадок и за собственный упадок.', 'Small World: Grand Dames'],
                ['Миролюбивые', 4, '+3 монеты, если не атаковал активных.', 'Small World: Grand Dames'],

                // Cursed!
                ['Проклятые', 0, 'Чтобы пропустить комбо — платить 3 монеты вместо 1.', 'Small World: Cursed!'],
                ['Орды', 5, '2 жетона Орды как дополнительные боевые жетоны.', 'Small World: Cursed!'],
                ['Набеговые', 5, 'После первой серии захватов делаешь вторую.', 'Small World: Cursed!'],
                ['Разоряющие', 4, 'Соперник платит монету за занятый регион, который ты взял.', 'Small World: Cursed!'],
                ['Оборотни', 4, 'В чётные раунды все штурмы на 2 дешевле.', 'Small World: Cursed!'],

                // Royal Bonus
                ['Водные', 3, '+1 монета за прибрежные регионы, прочие приносят на 1 меньше.', 'Small World: Royal Bonus'],
                ['Бегемоты', 4, 'Два стак-юнита равны числу болот, считаются как войска.', 'Small World: Royal Bonus'],
                ['Огненные Шары', 5, 'Получаешь маркеры-огншары, каждый = 2 жетона на атаку.', 'Small World: Royal Bonus'],

                // Sky Islands
                ['Воздушные', 3, 'В ход выбора — все штурмы на 2 дешевле.', 'Small World: Sky Islands'],
                ['Исследователи', 5, 'Бонус равный меньшему из количеств регионов на земле/в небе.', 'Small World: Sky Islands'],
                ['Златокузнецы', 4, '+2 монеты за шахты, прочие регионы −1 монета.', 'Small World: Sky Islands'],
                ['Канониры', 3, '2 пушки: иммунитет региона и штурм соседей на −2.', 'Small World: Sky Islands'],
                ['Торгаши', 5, 'Договора торговли: платёж/штраф за атаки по тебе.', 'Small World: Sky Islands'],
                ['Рэкетиры', 5, 'Монеты за пропуски комбо другими; следующая раса бесплатно.', 'Small World: Sky Islands'],
                ['Дирижабли', 5, 'До 5 авиаштурмов с кубиком; риск пожара.', 'Small World: Sky Islands'],

                // Underground (все числа с бейджей)
                ['Искатели Приключений', 5, '+1 монета за каждый Регион с Знаковым Местом.', 'Small World: Underground'],
                ['Рыбаки', 4, '+1 за каждую пару прибрежных регионов у реки.', 'Small World: Underground'],
                ['Стая', 4, '+2 монеты, если все регионы образуют один массив.', 'Small World: Underground'],
                ['Пугливые', 4, '+1 монета за регионы с ≥3 твоими жетонами.', 'Small World: Underground'],
                ['Бессмертные', 4, 'Потери берёшь в руку вместо сброса одного.', 'Small World: Underground'],
                ['Мешок-всего-на-свете', 5, 'Копирует силу одного из реликтов в игре.', 'Small World: Underground'],
                ['Мученики', 4, '+1 монета, когда соперник берёт твой регион.', 'Small World: Underground'],
                ['Шахтёры', 4, '+1 монета за каждую шахту.', 'Small World: Underground'],
                ['Грязевые', 3, '+1 монета за грязь, работает и в упадке.', 'Small World: Underground'],
                ['Мистики', 4, '+1 монета за кристаллы.', 'Small World: Underground'],
                ['Ссорящиеся', 3, '+1 монета за каждый отдельный кластер регионов.', 'Small World: Underground'],
                ['Возрождённые', 5, 'В упадке заменяют 1–2 регионов новыми жетонами.', 'Small World: Underground'],
                ['Королевские', 5, 'Королева делает регион иммунным.', 'Small World: Underground'],
                ['Щитоносцы', 5, 'Грибные доспехи дают +1 к защите, можно держать на карте.', 'Small World: Underground'],
                ['Каменные', 5, '+1 монета за чёрные горы.', 'Small World: Underground'],
                ['Воры', 4, 'Соседи платят монету, если граничат с твоими регионами.', 'Small World: Underground'],
                ['Гробницы', 5, 'Все жетоны остаются при упадке и можно ещё раз их передвинуть.', 'Small World: Underground'],
                ['Вампиры', 5, 'Раз в ход на игрока заменяют одиночный вражеский жетон.', 'Small World: Underground'],
                ['Исчезающие', 5, 'В упадке оставляют по 2 монеты на регион вместо 1.', 'Small World: Underground'],
                ['Мстительные', 4, 'Маркер мести: атакующий платит завышенную цену на 1.', 'Small World: Underground'],
                ['Мудрые', 4, '+2 монеты, если в упадке держат ≥1 регион.', 'Small World: Underground'],
            ];

            $raceDescriptionOverrides = [
                'Амазонки' => 'В фазу завоеваний берут 4 временных жетона и используют их только в этот ход; после перегруппировки эти жетоны возвращаются в запас. Захваты совершаются по обычным правилам смежности. В упадке бонус временных жетонов не работает.',
                'Гномы' => 'В конце хода получают +1 монету за каждую шахту под их контролем. Бонус действует только пока раса активна. При упадке приносят обычный доход без шахтного бонуса.',
                'Эльфы' => 'Когда теряют регион, один потерянный жетон возвращается на руку вместо сброса. Если жетон был превращён силой противника, он не возвращается. Все прочие правила захвата и упадка обычные.',
                'Упыри' => 'После ухода в упадок продолжают совершать завоевания своими упадшими жетонами в ваши ходы. Упадшие Упыри приносят доход как обычно. Пока Упыри на карте в упадке, у вас всё равно может быть только одна раса в упадке.',
                'Великаны' => 'Захваты из региона-Горы, который вы уже контролируете, стоят на 1 жетон дешевле. Бонус действует только на штурмы, начатые из ваших горных регионов. В упадке бонус не работает.',
                'Полурослики' => 'Ставят 2 норы на контролируемые регионы; регионы с норами неуязвимы для захвата. Начинать первый захват можно из любого региона карты. Норы остаются при упадке и сохраняют неуязвимость региона.',
                'Люди' => 'В конце хода получают +1 монету за каждое поле под контролем. Бонус действует только в активе. В упадке получают лишь базовый доход.',
                'Орки' => 'За каждый в этот ход взятый занятый регион получают +1 монету. Считаются регионы с жетонами соперников или племён/упадка. Бонус начисляется единожды за регион.',
                'Крысолюды' => 'Имеют много жетонов без дополнительных свойств. Сильны в ранней экспансии за счёт массы. В упадке работают как обычная раса.',
                'Скелеты' => 'В конце хода получают по 1 новому жетону из запаса за каждый в этот ход захваченный непустой регион. Новые жетоны доступны со следующего хода. В упадке бонус не действует.',
                'Колдуны' => 'Раз за ход на каждого соперника могут превратить одиночный вражеский жетон в соседнем регионе в свой, заняв регион без боя. Превращение считается завоеванием. Не действует на регионы с более чем одним жетоном.',
                'Тритоны' => 'Захваты прибрежных регионов стоят на 1 жетон дешевле. Прибрежными считаются регионы, граничащие с водой. В упадке бонус не действует.',
                'Тролли' => 'Каждый занятый регион получает Логово (+1 к защите); логова остаются на карте даже после потери региона и при упадке. Логова не дают монеты сами по себе.',
                'Волшебники' => 'В конце хода получают +1 монету за каждый регион с магическим символом под их контролем. Бонус действует только в активе. В упадке приносят базовый доход.',
                'Гоблины' => 'Берут на 1 жетон дешевле регионы, занятые упадшими расами или Племенем. Против активных соперников захваты обычные. В упадке свойство не работает.',
                'Кобольды' => 'Не могут оставлять по одному жетону в регионах: в каждом их регионе после перегруппировки должно лежать минимум 2 жетона. Компенсируют ограничение высокой численностью.',
                'Цыгане' => 'В фазу перегруппировки за каждый регион, который вы покинули в этот ход, получаете +1 монету. Можно «кочевать», освобождая и занимая другие регионы в том же ходу. В упадке бонус не действует.',
                'Жрицы' => 'Ставят Святилище в одном своём регионе. При уходе в упадок все жетоны Жриц помещаются под Святилище; регион становится неуязвим и продолжает приносить доход, но жетоны нельзя перемещать, пока Святилище не будет снято.',
                'Белые Дамы' => 'Имеют мало жетонов, но их регионы неуязвимы для захвата и эффектов соперников, пока их жетоны там присутствуют. Неуязвимость сохраняется и в упадке. Захваты совершают по обычным правилам.',
                'Фавны' => 'В конце хода получают +1 монету за каждый новый захваченный в этот ход регион, который смежен хотя бы с одним регионом, взятым ранее в этот же ход. Бонус учитывается по одному разу на регион. В упадке не действует.',
                'Игорьцы' => 'Когда берут занятый регион, один сбрасываемый жетон противника можно сохранить как «трофей». За каждые два трофея при перегруппировке получают 1 дополнительный свой жетон. Трофеи не считаются войсками на карте.',
                'Кустолюды' => 'В активе приносят обычный доход. Пока раса в упадке, каждый лес под их контролем приносит +1 монету. Бонус работает только в упадке.',
                'Варвары' => 'Не выполняют перегруппировку: жетоны остаются там, где завершили завоевания. Можно продолжать захваты в следующих ходах, двигаясь «фронтом». В упадке работают обычно.',
                'Гомункулы' => 'Пока комбо не выбирают, на его баннер накапливаются дополнительные жетоны. При выборе берёте базовое число плюс накопленные. После каждого вашего хода один накопленный жетон сбрасывается.',
                'Лепреконы' => 'В конце своего хода могут положить по одному Горшочку Золота в каждый занятый регион. Если регион удержан к вашему следующему ходу, получите по +1 монете с Горшочка; если регион потерян, монету забирает захватчик.',
                'Пикси' => 'В перегруппировке оставляют ровно по одному жетону в каждом своём регионе. Высокая численность компенсирует уязвимость. В упадке работают как обычная раса.',
                'Пигмеи' => 'Когда теряют жетон в защите, возвращают из запаса один жетон Пигмеев на руку. Возврат происходит не чаще одного жетона за потерю региона. Прочие правила обычные.',
                'Ледяные Ведьмы' => 'После завоеваний могут «заморозить» выбранные соседние регионы: в них нельзя совершать новые захваты и перегруппировку до начала вашего следующего хода. Заморозка не отменяет подсчёт дохода владельца.',
                'Скагги' => 'Получают больше монет, когда их регионы рассредоточены: если ни один ваш регион не граничит с двумя другими вашими, получите +1 монету в конце хода. Бонус не действует в упадке.',
                'Пращники' => 'Могут раз за захват переходить через один чужой или пустой регион и брать следующий за ним, соблюдая направление атаки. Такой дальний штурм считается обычным завоеванием. В упадке способность не работает.',
                'Драконы' => 'Во время завоеваний могут временно наделять часть своих жетонов «драконьей силой», игнорируя одиночные защитные маркеры в цели. В конце хода все жетоны снова обычные. В упадке свойство не действует.',
                'Эскарго' => 'Очень многочисленны, но ограничены в манёвре: первый вход и новые штурмы должны расширять единый непрерывный массив ваших регионов. Перескоки через разрывы запрещены. В упадке обычные.',
                'Ханы' => 'Легче захватывают степи и быстрее по ним продвигаются: штурмы степных регионов на 1 дешевле, если следующий шаг тоже ведёт в степь. В упадке бонус не действует.',
                'Пугала' => 'Могут размещать пустышки-стражи в занятых регионах; такие регионы неуязвимы, пока там есть страж. Пустышки не считаются жетонами расы и не приносят монеты. В упадке стражи остаются.',
                'Падальщики' => 'В конце хода получают +1 монету за каждый регион на карте, который в этот ход был опустошён или покинут владельцем. Бонус складывается с обычным доходом. В упадке не действует.',
                'Грозовые Великаны' => 'Раз за ход перед штурмом могут поразить молнией цель, снизив её стоимость на 2 жетона. Молния не действует на неуязвимые регионы. В упадке способность не работает.',
                'Вендиго' => 'Регионы, занятые Вендиго, «закоченевают»: до вашего следующего хода их нельзя покидать и усиливать перегруппировкой. Владелец по-прежнему получает монеты. В упадке эффект не применяется.',
                'Культисты' => 'Ставят Древнего в одном своём регионе. Регионы, соседние с Древним, стоят на 1 жетон дешевле для ваших завоеваний. Древний остаётся при упадке, но скидка действует только в активе.',
                'Дроу' => 'В конце хода получают +1 монету за каждый свой изолированный регион или кластер, не смежный с остальными вашими территориями. Поощряют разобщённое владение. В упадке бонус не действует.',
                'Пламя' => 'Могут из своей «вулканической» точки сделать соседние регионы пустыми для атаки в этот ход. Фишки противников из таких регионов сбрасываются как обычно. В упадке способность не работает.',
                'Гномы Подземья' => 'На ход соперников неуязвимы к их активным эффектам и спецмаркерам; их регионы можно взять только обычным штурмом. В ваш ход действуют все обычные правила.',
                'Железные Гномы' => 'Получают ограниченные «серебряные молоты», каждый из которых даёт +2 к силе на один штурм и затем сбрасывается. Молоты нельзя использовать в защите. В упадке не работают.',
                'Грязевики' => 'Если контролируют регионы с грязью/топью, в начале хода берут 1–2 временных боевых жетона и могут использовать их только в этот ход. В упадке временные жетоны не выдаются.',
                'Мумии' => 'Все их штурмы дороже на 1 жетон. Компенсируют это большим стартовым числом жетонов и высокой живучестью. В упадке обычны.',
                'Огры' => 'Все их штурмы на 1 жетон дешевле. Бонус не действует в упадке. Прочие правила без изменений.',
                'Тенемимы' => 'В начале своего хода могут заменить свою текущую спецсилу на любую одну из видимых в очереди. Замена мгновенна и действует целый ход. Менять силу можно каждый ход.',
                'Грибники' => 'В конце хода получают +1 монету за каждый грибной лес под контролем. Бонус действует только в активе. В упадке базовый доход.',
                'Паукоиды' => 'Считают пропасти смежными: могут захватывать через пропасть как по обычной границе. Прочие ограничения смежности сохраняются. В упадке способность не работает.',
                'Блуждающие Огни' => 'Перед штурмом регионов с кристаллами кидают кубик подкрепления и добавляют результат к силе. Бросок производится до выкладки жетонов. В упадке свойство не действует.',
                'Ящеролюды' => 'Могут перемещаться вдоль реки между своими речными регионами без обязательного оставления жетонов на промежуточных участках. Захваты с речных плацдармов обычные. В упадке эффект не работает.',
                'Личи' => 'Когда соперник берёт ваш регион Личей в упадке, он платит вам 1 монету за такой захват. В активе свойства нет. Прочие правила обычные.',
                'Кракен' => 'Могут занимать речные регионы и получать за них монеты, как за обычные. На реке можно оставлять жетоны при перегруппировке. В упадке речные регионы продолжают приносить доход.',
            ];

            $abilityDescriptionOverrides = [
                'Алхимик' => 'В конце каждого вашего хода получаете +2 монеты сверх обычного дохода. Бонус действует только пока комбо активно.',
                'Берсерк' => 'Перед каждым своим штурмом бросаете кубик подкрепления и добавляете результат к силе атаки. Затем выкладываете жетоны с учётом результата.',
                'Лагеря' => 'Имеете 5 лагерей; каждый добавляет +1 к защите региона. Лагеря можно переставлять в фазу перегруппировки. При потере региона лагерь снимается.',
                'Коммандос' => 'Все ваши штурмы стоят на 1 жетон дешевле. Скидка не действует на неуязвимые регионы и не распространяется на эффекты, которые заменяют штурм.',
                'Дипломат' => 'В конце своего хода выбираете одного соседа; до вашего следующего хода он не может атаковать ваши регионы. Если вы атаковали его в этот ход, дипломатия не устанавливается.',
                'Повелитель Дракона' => 'Раз за ход можете совершить один «драконий» захват за 1 жетон, положив маркер Дракона; этот регион становится неуязвим, пока вы его держите. Маркер остаётся при упадке, но новых драконих захватов в упадке нет.',
                'Летающие' => 'Можно захватывать любой регион на карте, игнорируя требование смежности, включая первый вход. Прочие ограничения и стоимости сохраняются.',
                'Лесные' => 'В конце хода получаете +1 монету за каждый лес под контролем. Бонус действует только в активе.',
                'Укреплённые' => 'В конце каждого своего хода можно поставить одну крепость в занятом регионе: она даёт +1 к защите и +1 монету. Крепости остаются при упадке, но монет не дают.',
                'Героические' => 'Кладёте 2 героических маркера на любые свои регионы; эти регионы неуязвимы для захвата и эффектов. Маркеры можно перемещать при перегруппировке.',
                'Холмистые' => 'В конце хода получаете +1 монету за каждый холм под контролем. Бонус действует только в активе.',
                'Торговцы' => 'В конце хода получаете +1 монету за каждый контролируемый регион сверх базового дохода. Бонус работает только в активе.',
                'Всадники' => 'Захваты холмов и полей стоят на 1 жетон дешевле. В упадке бонус не действует.',
                'Грабящие' => 'В конце хода получаете +1 монету за каждый в этот ход взятый занятый регион. Бонус начисляется один раз за регион.',
                'Мореплаватели' => 'Могут захватывать и удерживать Моря и Озёра, которые обычно недоступны. Водные регионы дают обычный доход и служат плацдармами для соседних захватов. В упадке водные регионы продолжают приносить доход; начинать новые захваты с воды нельзя.',
                'Духи' => 'Когда уходят в упадок, не занимают слот упадка: вы можете взять новую расу, сохранив упавших Духов на карте. Доход с Духов учитывается как обычно.',
                'Выносливые' => 'Можно уйти в упадок сразу после обычного хода вместо ожидания следующего. Все действия выполняются в один ход по порядку.',
                'Болотные' => 'В конце хода получаете +1 монету за каждое болото под контролем. Бонус действует только в активе.',
                'Подземные' => 'Пещеры для вас стоят на 1 жетон дешевле, а все пещеры считаются смежными между собой для целей первого входа и дальнейших захватов. В упадке бонус не действует.',
                'Богатые' => 'В конце вашего первого хода разово получаете +7 монет. Дальше действует обычный доход.',
                'Подражатели' => 'В начале каждого вашего хода выбираете и копируете одну из шести видимых спецсил до конца хода. Если сила даёт маркеры, вы их получаете на этот ход.',
                'Лава' => 'После завершения хода размещаете потоки лавы от занятых гор в соседние регионы; такие регионы блокированы для захватов и перегруппировок до начала вашего следующего хода.',
                'Прикосновение Душ' => 'Когда вы уходите в упадок, вместо взятия новой расы «оживляете» свою предыдущую упавшую расу: она снова становится активной с теми жетонами, что остались.',
                'Баррикады' => 'Если в конце вашего хода у вас 4 или меньше регионов, получите +3 монеты. При большем числе регионов бонуса нет.',
                'Катапульта' => 'Разместите катапульту в одном своём регионе: он становится неуязвим. Раз за ход можете взять несмежный регион «через» катапульту. Катапульта остаётся при упадке, но стрелять не может.',
                'Коррупция' => 'Каждый раз, когда соперник захватывает ваш активный регион, он платит вам 1 монету. В упадке платежей нет.',
                'Имперские' => 'В конце хода получаете +1 монету за каждый контролируемый регион сверх трёх. Бонус действует только в активе.',
                'Наёмники' => 'Можно тратить монеты, чтобы снизить стоимость конкретного штурма на 2 за каждую потраченную монету. Разрешено несколько раз за ход.',
                'Историки' => 'Получаете +1 монету за каждую расу в упадке на карте. Когда сами уходите в упадок, дополнительно получите +1 монету.',
                'Миролюбивые' => 'Если в этот ход вы не атаковали активные регионы соперников, получите +3 монеты в конце хода. Захваты племён/упадших разрешены.',
                'Проклятые' => 'Чтобы пропустить комбо в очереди, нужно заплатить 3 монеты вместо 1. На ваш доход это не влияет.',
                'Орды' => 'Получаете 2 жетона Орды как дополнительные боевые единицы на время завоеваний. Они не остаются на карте после перегруппировки.',
                'Набеговые' => 'После завершения первой серии захватов вы можете выполнить вторую серию захватов. Перегруппировка выполняется один раз в конце.',
                'Разоряющие' => 'Соперник платит вам 1 монету за каждый его занятый регион, который вы захватили в этот ход. Платёж берётся сразу.',
                'Оборотни' => 'В чётные раунды все ваши штурмы на 2 жетона дешевле. В нечётные — без скидки.',
                'Водные' => '+1 монета за каждый прибрежный регион; все прочие ваши регионы приносят на 1 монету меньше. Балансируйте между берегом и сушей.',
                'Бегемоты' => 'Имеете 2 стека-тяжеловеса, каждый равен числу болот на карте; кладутся поверх ваших жетонов и считаются войсками для атаки/защиты. Тяжеловесы нельзя разделять.',
                'Огненные Шары' => 'Получаете маркеры огнешаров; каждый при атаке считается как +2 жетона и затем сбрасывается. В защите не используются.',
                'Воздушные' => 'В ход выбора этого комбо все ваши штурмы на 2 жетона дешевле. В последующие ходы скидки нет.',
                'Исследователи' => 'В конце хода получаете бонус, равный меньшему из количеств регионов на земле и на небесных островах. Стремитесь к балансу.',
                'Златокузнецы' => 'Получаете +2 монеты за каждую шахту, но все прочие ваши регионы приносят на 1 монету меньше. Бонус действует в активе.',
                'Канониры' => 'Имеете 2 пушки. Регион с пушкой неуязвим; из него соседние цели штурмуются на 2 жетона дешевле. Пушки можно перемещать при перегруппировке.',
                'Торгаши' => 'Можете объявлять торговые договоры с соседями: за атаки по вам они платят оговорённую сумму; если отказываются, вы получаете штраф с них по умолчанию. Договоры действуют до вашего следующего хода.',
                'Рэкетиры' => 'Когда другие игроки пропускают комбо в очереди, получаете монеты. Следующую вашу расу можно взять бесплатно один раз, сбросив накопленный «взнос».',
                'Дирижабли' => 'До 5 авиаштурмов за ход с броском кубика подкрепления на каждый. При неудаче регион может «сгореть», и ваши жетоны там сбрасываются.',
                'Искатели Приключений' => '+1 монета за каждый регион со знаковым местом под вашим контролем. Бонус только в активе.',
                'Рыбаки' => '+1 монета за каждую пару ваших прибрежных регионов у реки. Округление вниз.',
                'Стая' => '+2 монеты в конце хода, если все ваши регионы образуют один непрерывный массив. При разрывах бонуса нет.',
                'Пугливые' => '+1 монета за каждый ваш регион, в котором лежит 3 и более ваших жетонов. Поощряет плотную оборону.',
                'Бессмертные' => 'Когда теряете жетоны в защите, вместо сброса один из потерянных возвращается вам на руку. Срабатывает на каждую потерю.',
                'Мешок-всего-на-свете' => 'Копирует эффект одного из реликтов, находящихся в игре. Копирование выбирается в начале хода и действует до его конца.',
                'Мученики' => 'Каждый раз, когда соперник берёт ваш регион, получите +1 монету. В упадке бонус не действует.',
                'Шахтёры' => '+1 монета за каждую шахту под вашим контролем в конце хода. Только в активе.',
                'Грязевые' => '+1 монета за каждый регион с грязью/топью под вашим контролем; бонус работает и в упадке.',
                'Мистики' => '+1 монета за каждый регион с кристаллами под вашим контролем. Только в активе.',
                'Ссорящиеся' => '+1 монета за каждый отдельный кластер ваших регионов на карте. Поощряет дробление владений.',
                'Возрождённые' => 'Пока ваши прежние регионы в упадке, при выборе новой расы вы можете заменить 1–2 регионов упадка свежими жетонами новой расы, сохранив контроль.',
                'Королевские' => 'Кладёте маркер Королевы в один свой регион; он становится неуязвимым. Маркер можно перемещать в перегруппировке; при потере региона Королева снимается.',
                'Щитоносцы' => 'Получаете грибные щиты: каждый даёт +1 к защите региона. Лишние щиты можно оставлять на карте как укрепления.',
                'Каменные' => '+1 монета за каждый регион Чёрных Гор под вашим контролем. Только в активе.',
                'Воры' => 'В конце хода каждый сосед, граничащий с вашими регионами, платит вам по 1 монете. Платёж совершается один раз с игрока за ход.',
                'Гробницы' => 'При упадке все ваши жетоны остаются на местах; один раз сразу после упадка вы можете их перераспределить по своим упавшим регионам. Доход идёт как обычно.',
                'Вампиры' => 'Раз за ход на каждого игрока можете заменить одиночный вражеский жетон в соседнем регионе своим жетоном, заняв регион. Не действует на регионы с несколькими жетонами.',
                'Исчезающие' => 'Когда покидаете регион в перегруппировке или упадке, оставляете на нём 2 монеты вместо 1. Монеты забирает следующий владелец региона.',
                'Мстительные' => 'Кладёте маркер мести на свой регион; следующий штурм этого региона стоит атакующему на 1 жетон дороже. Маркер снимается после срабатывания.',
                'Мудрые' => 'В конце хода получаете +2 монеты, если у вас есть хотя бы один регион в упадке под контролем. В отсутствие упавших владений бонуса нет.',
            ];

            $races = array_map(function ($r) use ($raceDescriptionOverrides) {
                if (isset($raceDescriptionOverrides[$r[0]])) {
                    $r[2] = $raceDescriptionOverrides[$r[0]];
                }
                return $r;
            }, $races);

            $abilities = array_map(function ($a) use ($abilityDescriptionOverrides) {
                if (isset($abilityDescriptionOverrides[$a[0]])) {
                    $a[2] = $abilityDescriptionOverrides[$a[0]];
                }
                return $a;
            }, $abilities);

            $raceRows = [];
            foreach ($races as [$name, $qty, $desc, $ed]) {
                $raceRows[] = [
                    'name' => $name,
                    'qty' => $qty,
                    'description' => $desc,
                    'image' => null,
                    'edition_id' => $editionIds[$ed] ?? null,
                    'created_at' => $now,
                    'updated_at' => $now,
                ];
            }
            DB::table('smallworld.races')->insert($raceRows);

            $abilityRows = [];
            foreach ($abilities as [$name, $qty, $desc, $ed]) {
                $abilityRows[] = [
                    'name' => $name,
                    'qty' => $qty,
                    'description' => $desc,
                    'image' => null,
                    'edition_id' => $editionIds[$ed] ?? null,
                    'created_at' => $now,
                    'updated_at' => $now,
                ];
            }

            DB::table('smallworld.abilities')->insert($abilityRows);
        });
    }
}
